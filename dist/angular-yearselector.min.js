"use strict";if("undefined"==typeof moment){var moment;throw"Exception: moment.js is undefined. Please add the library as a dependency to your project"}angular.module("yearSelector",[]),angular.module("yearSelector").directive("yearSelector",["$parse","$document","$http","$timeout","$compile","$templateCache",function(a,b,c,d,e,f){return{restrict:"A",templateUrl:"angular-yearselector.html",link:function(a,g,h){function i(a,b,c){for(var d=-1,e=a?a.length:0,f=function(a,b,c,d){return a[b]===c?d:void 0};++d<e;)if(f(a[d],b,c,d)>-1)return d;return-1}function j(b){var c,d;return b.length>1?b[0]<b[1]?(c=moment().year(a.yearsSelDRP[b[0]].year).startOf("year").format("MM-DD-YYYY"),d=a.yearsSelDRP[b[1]].year===moment().year()?moment().format("MM-DD-YYYY"):moment(moment().year(a.yearsSelDRP[b[1]].year)).endOf("year").format("MM-DD-YYYY"),c+":"+d):(c=moment().year(a.yearsSelDRP[b[1]].year).startOf("year").format("MM-DD-YYYY"),d=a.yearsSelDRP[b[0]].year===moment().year()?moment().format("MM-DD-YYYY"):moment(moment().year(a.yearsSelDRP[b[0]].year)).endOf("year").format("MM-DD-YYYY"),c+":"+d):a.yearsSelDRP[b].year}var k={years:10,months:!1,model:"",attachTo:!1,attachNow:!1,externalCallback:!1,range:!0,drag:!0,templateUrl:"angular-yearselector.html"},l=[];a.yearsSelDRP=[],a.dragEnabled=!1,a.buttonSize=40;var m,n,o,p,q,r=!0,s=!1,t=function(b){var c=function(){var a;for(a=0;a<b.length;a++)b[a].inbetween=!1},d=function(a){var b;b=a[0]<a[1]?!0:!1;var c=Math.floor(b?a[1]-a[0]:a[0]-a[1]);return b&&a[2]>a[1]?[a[1],"1"]:b&&a[2]<a[0]?[a[0],"0"]:!b&&a[2]<a[0]?[a[0],"0"]:!b&&a[2]>a[1]?[a[1],"1"]:b&&a[2]<a[1]&&a[2]>a[0]||!b&&a[2]>a[0]&&a[2]<a[1]?a[1]-c>a[0]-c?[a[0],"0"]:[a[1],"1"]:void 0},e=function(){c();var a,d;if(l[1]-l[0]>1)for(a=l[0]+1;a<l[1];a++)b[a].inbetween=!0;else if(l[1]-l[0]<0)for(d=l[1]+1;d<l[0];d++)b[d].inbetween=!0};if(2===l.length)e();else if(l.length>2){var f=d(l);f[1]=parseInt(f[1]),a.yearsSelDRP[f[0]].active=!1,l.splice(f[1],1),e()}};a.selectYear=function(b,c){s&&y(c);var d=i(a.yearsSelDRP,"year",b);l.indexOf(d)>-1||(l.push(d),a.yearsSelDRP[d].active=!0,t(a.yearsSelDRP,b),p(j(l)))};var u=function(b,c){l.indexOf(c)>-1||(a.yearsSelDRP[b].active=!1,l.splice(l.indexOf(b),1),a.yearsSelDRP[c].active=!0,l.push(c),t(a.yearsSelDRP),p(j(l)),a.$apply())},v=function(b){q=b.prop("offsetWidth"),a.buttonSize=q/a.yearsSelDRP.length-4},w=function(c){function e(b){g=b.pageX-j-(a.buttonSize+4)/2,i.css("left",g+"px")}function f(c){b.unbind("mousemove",e),b.unbind("mouseup",f),i.css("left","-500px");var d=c.pageX-j;u(h,Math.round(d/a.buttonSize)-1)}a.dragEnabled=!0;var g,h,i=angular.element(c.children().children()[0]),j=c[0].getBoundingClientRect().left;c.on("mousedown",function(a){var c=angular.element(a.srcElement);c.hasClass("active")&&(h=c[0].tabIndex,i.css("left",c.prop("offsetLeft")+"px"),d(function(){b.on("mousemove",e),b.on("mouseup",f)},100))})},x=function(d){m=angular.element(b[0].querySelector(d)),v(m),c.get(k.templateUrl,{cache:f}).success(function(b){m.append(b),e(m)(a),w(m)})},y=function(b){console.log(b),a.mumu=function(){console.log("mumu")};var c='<div class="ms" ng-click="mumu()">1 2</div>',d=angular.element(b.srcElement);d[0].querySelector(".ms")?console.log("It exists"):(d.append(c),e(c)(a))};a.$watch(h.yearSelector,function(b){b=angular.extend(angular.copy(k),b),n=moment(moment().subtract("years",b.years)).startOf("year"),o=moment().year()-moment(n).year(),a.yearsSelDRP=[];for(var c=1;o>=c;c++)a.yearsSelDRP.push({year:moment().year()-(o-c),active:!1,inbetween:!1});b.range||(r=!1),b.drag&&!b.attachTo&&w(g),b.attachTo?(g.remove(),b.attachNow&&(l=[],a[b.model]="",x(b.attachTo))):v(g),b.months&&(s=!0),p=function(c){a[b.model]=c}})}}}]),angular.module("yearSelector").run(["$templateCache",function(a){a.put("angular-yearselector.html",'<div class="ar-year-selector">\n    <div class="cursor" ng-style="{\'width\': (buttonSize + 4) + \'px\'}">\n    </div>\n    <button href="javascript:;"\n       ng-repeat="year in yearsSelDRP track by $index"\n'+"       ng-class=\"{'active': year.active, 'inbetween': year.inbetween, 'draggable': dragEnabled, 'first-el': $index == 0, 'last-el': $index == (yearsSelDRP.length - 1) }\"\n       ng-click=\"selectYear(year.year, $event)\"\n       ng-style=\"{'width': buttonSize + 'px'}\"\n       tabindex=\"{{$index}}\">\n        {{year.year}}\n    </button>\n</div>")}]);